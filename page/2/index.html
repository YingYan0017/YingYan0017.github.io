<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Loloooo">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Loloooo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="lolo">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Loloooo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Loloooo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">lolo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/01/Redis-%E7%AE%A1%E9%81%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/01/Redis-%E7%AE%A1%E9%81%93/" class="post-title-link" itemprop="url">Redis-管道</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-04-01 15:09:35 / 修改时间：15:33:59" itemprop="dateCreated datePublished" datetime="2024-04-01T15:09:35+08:00">2024-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="管道pipelining"><a href="#管道pipelining" class="headerlink" title="管道pipelining"></a>管道pipelining</h1><p>redis事一种基于客户端-服务端模型以及请求&#x2F;响应协议的TCP服务，一个请求会遵循一下的步骤：</p>
<ol>
<li>客户端向服务端发送命令分四步（发送命令-&gt;命令排队-&gt;命令执行-&gt;返回结果），并监听socket返回，通常以阻塞模式等待服务端的响应。</li>
<li>服务端处理命令，并将结果返回给客户端</li>
</ol>
<p>&#x3D;&#x3D;以上两部称为 Round Trip Time&#x3D;&#x3D;</p>
<img src="../blog_images/Redis-%E7%AE%A1%E9%81%93/image-20240401151605018.png" alt="image-20240401151605018" style="zoom:33%;" />

 

<p><img src="/../blog_images/Redis-%E7%AE%A1%E9%81%93/image-20240401151638019.png" alt="image-20240401151638019"></p>
<p>管道的解决思路： 管<strong>道可以一次性的发送多条命令给服务端，服务端依次处理完毕之后，通过 一条响应一次寻的将结果返回，通过减少客户端与redis的通信次数来实现降低往返延时时间</strong>。</p>
<p>将几个频繁往返的命令合起来</p>
<p>pipeline实现的原理是队列，先进先出特性就保证了数据的顺序性。</p>
<img src="../blog_images/Redis-%E7%AE%A1%E9%81%93/image-20240401151958228.png" alt="image-20240401151958228" style="zoom:33%;" />

<blockquote>
<p>&#x3D;&#x3D;批处理命令变种的优化措施，类似于Redis的原生批命令（mget和mset）&#x3D;&#x3D;</p>
</blockquote>
<img src="../blog_images/Redis-%E7%AE%A1%E9%81%93/image-20240401152633289.png" alt="image-20240401152633289" style="zoom:33%;" />

<img src="../blog_images/Redis-%E7%AE%A1%E9%81%93/image-20240401152656048.png" alt="image-20240401152656048" style="zoom:33%;" />

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h1 id="Pipeline-与原生批量命令对比"><a href="#Pipeline-与原生批量命令对比" class="headerlink" title="Pipeline 与原生批量命令对比"></a>Pipeline 与原生批量命令对比</h1><ul>
<li>原生命令是原子性的（例如mset、mget） 管道是非原子性的</li>
<li>原生批量命令只能执行一种命令，pipeline可以执行不同种的命令</li>
<li>原生批命令是服务端实现的 ，而pipeline需要服务端和客户端一起实现。</li>
</ul>
<h1 id="Pipeline与事务对比"><a href="#Pipeline与事务对比" class="headerlink" title="Pipeline与事务对比"></a>Pipeline与事务对比</h1><ul>
<li>事务具有原子性，管道是不具有原子性的</li>
<li>管道一次性将多条命令发送给服务器，事务是一条一条法的，事务只有在接收到exec命令之后才会执行</li>
<li>执行事务时会阻塞其他命令的执行，而执行管道中的命令时不会。</li>
</ul>
<h1 id="使用Pipeline的注意事项"><a href="#使用Pipeline的注意事项" class="headerlink" title="使用Pipeline的注意事项"></a>使用Pipeline的注意事项</h1>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/01/Redis-%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/01/Redis-%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">Redis-事务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-04-01 13:07:31 / 修改时间：21:32:02" itemprop="dateCreated datePublished" datetime="2024-04-01T13:07:31+08:00">2024-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p> 其实就是同一组指令需要一起执行。</p>
<p>一个队列中、一次性、顺序性、排他性的执行一系列的命令</p>
<h2 id="redis与数据库事务的区别"><a href="#redis与数据库事务的区别" class="headerlink" title="redis与数据库事务的区别"></a>redis与数据库事务的区别</h2><img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401135206539.png" alt="image-20240401135206539" style="zoom: 25%;" />

<h2 id="怎么使用"><a href="#怎么使用" class="headerlink" title="怎么使用"></a>怎么使用</h2><h3 id="case1：正常执行"><a href="#case1：正常执行" class="headerlink" title="case1：正常执行"></a>case1：正常执行</h3><h4 id="MULTI"><a href="#MULTI" class="headerlink" title="MULTI"></a>MULTI</h4><p>开启事务</p>
<img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401141119017.png" alt="image-20240401141119017" style="zoom:25%;" />

<p>后续的命令要加入这个是事务当中</p>
<h4 id="EXEC-结束"><a href="#EXEC-结束" class="headerlink" title="EXEC 结束"></a>EXEC 结束</h4><h3 id="case2：放弃事务"><a href="#case2：放弃事务" class="headerlink" title="case2：放弃事务"></a>case2：放弃事务</h3><h4 id="MULTI-1"><a href="#MULTI-1" class="headerlink" title="MULTI"></a>MULTI</h4><h4 id="DISCARD"><a href="#DISCARD" class="headerlink" title="DISCARD"></a>DISCARD</h4><p>这个输入之后就是全体放弃，之前执行一半的事务全部撤销</p>
<img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401141941014.png" alt="image-20240401141941014" style="zoom:33%;" />

<p>相当于一个是编译报错一个是运行时报错</p>
<h3 id="case3：全体连坐"><a href="#case3：全体连坐" class="headerlink" title="case3：全体连坐"></a>case3：全体连坐</h3><blockquote>
<p>一条命令出错全部打回去</p>
<p>语法出错了，直接编译就存在问题，当然执行不了</p>
</blockquote>
<img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401142255133.png" alt="image-20240401142255133" style="zoom:33%;" />

<h3 id="case4：冤有头债有主"><a href="#case4：冤有头债有主" class="headerlink" title="case4：冤有头债有主"></a>case4：冤有头债有主</h3><blockquote>
<p>对的执行，错的停止，类似于运行时异常，当一个命令失败了，</p>
<p>类似于语法没有检查出错误</p>
</blockquote>
<img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401142554856.png" alt="image-20240401142554856" style="zoom:33%;" />

<h3 id="case5：watch监控"><a href="#case5：watch监控" class="headerlink" title="case5：watch监控"></a>case5：watch监控</h3><p>redis会使用watch来提供乐观锁定，类似于CAS（check-and-Set）</p>
<blockquote>
<p>乐观锁：optimistic lock 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下再次期间别人有没有去更新这个数据</p>
<p>乐观锁的策略： 提交版本必须大于记录当前版本才能执行更新</p>
</blockquote>
<p>拿一个watch监控一个key，如果这个key在监控期间没有人动过，皆大欢喜，否则，本次执行的操作就会设置成一个null。</p>
<p>watch 初始化k1 和balance两个key，先监控再开启multi，保证两个key变动在同一个事务当中。</p>
<img src="../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401144932380.png" alt="image-20240401144932380" style="zoom:33%;" />

<p><strong>有加塞篡改</strong></p>
<h3 id="case6：unwatch"><a href="#case6：unwatch" class="headerlink" title="case6：unwatch"></a>case6：unwatch</h3><p><img src="/../blog_images/Redis-%E4%BA%8B%E5%8A%A1/image-20240401145239659.png" alt="image-20240401145239659"></p>
<p>放弃监控</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>一旦执行了exec之前加的监控锁都会被取消掉，当客户端连接丢失的时候（比如退出连接），所有的东西都会被取消监控</p>
<ul>
<li>开启：以MULTI 开启一个事务</li>
<li>入队：将多个命令入队到事务当中去，接到这些命令并不会立即的执行，而是会放到等待执行的事务队列中</li>
<li>执行：由EXEC命令触发事务</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/31/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/31/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/" class="post-title-link" itemprop="url">Redis-持久化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-31 21:15:11" itemprop="dateCreated datePublished" datetime="2024-03-31T21:15:11+08:00">2024-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-01 13:06:29" itemprop="dateModified" datetime="2024-04-01T13:06:29+08:00">2024-04-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><p>就是把数据写到磁盘里面。在实际的应用场景中，会存在服务器突然的宕机，数据全部打到mysql上，这个对于我们来说是灾难性的，所以我们需要让redis可以自己把数据写到服务器中</p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331212516033.png" alt="image-20240331212516033"></p>
<h2 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB(Redis DataBase)"></a>RDB(Redis DataBase)</h2><p>RDB持久性以指定的时间间隔执行数据集的时间点快照。</p>
<p>实现类似于照片记录效果的方式，就是把某个时刻的数据与状态以文件的形式写到了磁盘的上面，也就是快照。这样一来，即使是服务器故障宕机，快照文件也不会丢失，数据的可靠性也得到了保证。</p>
<p>&#x3D;&#x3D;这个快照文件也被称为了RDB文件（dump.rdb),其中，RDB就是Redis Database的缩写&#x3D;&#x3D;</p>
<p>会直接去读这个dump.rdb文件，重新写回redis的缓存里</p>
<h3 id="Redis6与Redis7"><a href="#Redis6与Redis7" class="headerlink" title="Redis6与Redis7"></a>Redis6与Redis7</h3><p>在Redis7里面，把持久话RDB的保存规则发生了改变，尤其是时间记录额度的变化</p>
<p>vim redis7.conf,因为底层做了优化，所以不需要像之前一样记录的那么频繁了</p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331213643968.png" alt="image-20240331213643968"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331213709629.png" alt="image-20240331213709629"></p>
<h3 id="自动触发"><a href="#自动触发" class="headerlink" title="自动触发"></a>自动触发</h3><p>redis 默认使用</p>
<p>**<img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331230827587.png" alt="image-20240331230827587"><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331231302890.png" alt="image-20240331231302890"> </p>
<p>执行flashall&#x2F;flushdb命令也会产生dump.rdb文件，但是里里面是空的，没有意义</p>
<h3 id="手动触发"><a href="#手动触发" class="headerlink" title="手动触发"></a>手动触发</h3><p>满足不了要求，但是希望是立马就备份，产生rdb文件，就需要开启手动的备份</p>
<p>redis提供了两个命令来生成RDB文件，分别是save喝bdsave</p>
<p>相当于在后台开启了一个子进程，可以立即的开启备份</p>
<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331232230372.png" alt="image-20240331232230372" style="zoom: 25%;" />

<p>生产上只能用bgsave，绝对不能用save</p>
<h4 id="save"><a href="#save" class="headerlink" title="save"></a>save</h4><p>在主程序中执行回阻塞当前的redis服务器，直到持久化工作完成执行save命令期间，redis是不能处理其他命令的，线上是禁止使用的</p>
<h4 id="bgsave（默认）"><a href="#bgsave（默认）" class="headerlink" title="bgsave（默认）"></a>bgsave（默认）</h4><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331232606065.png" alt="image-20240331232606065"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331232850986.png" alt="image-20240331232850986"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331232902475.png" alt="image-20240331232902475"></p>
<p><strong>什么是fork</strong></p>
<p>在Linux系统中，fork会产生一个与父进程完全向同伴的一个子进程，但是子进程会在此后多会exec系统调用，处于效率考虑，尽量的避免膨胀</p>
<h4 id="lastsave"><a href="#lastsave" class="headerlink" title="lastsave"></a>lastsave</h4><p>可以通过lastsave命令去获取最后一次成功执行快照的时间</p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331233019774.png" alt="image-20240331233019774"></p>
<h3 id="RDB-优缺点"><a href="#RDB-优缺点" class="headerlink" title="RDB 优缺点"></a>RDB 优缺点</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>适合大规模的数据恢复</li>
<li>按照业务定时进行备份</li>
<li>对于数据的完整性喝一致性的要求不高</li>
<li>RDB文件在内存中的加载速度要比AOF快得多</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><p>如果你需要在redis停止工作时，比如断电之后，把损失降低到最低，那么rdb并不好</p>
<p>RDB需要经常的fork()以便使用子进程在磁盘上持久话，如果数据集很大，fork()可能会很耗时，并且数据集很大而且CPU性能不是很好的时候，可能会导致Redis停止为客户端服务几毫秒甚至于疫苗</p>
<p>如何检查并修复我们的RDB文件</p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234106128.png" alt="image-20240331234106128"> </p>
<h3 id="如何禁用快照"><a href="#如何禁用快照" class="headerlink" title="如何禁用快照"></a>如何禁用快照</h3><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234255878.png" alt="image-20240331234255878"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234309380.png" alt="image-20240331234309380"></p>
<h3 id="RDB优化配置项详解snapshotting模块"><a href="#RDB优化配置项详解snapshotting模块" class="headerlink" title="RDB优化配置项详解snapshotting模块"></a>RDB优化配置项详解snapshotting模块</h3><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234534060.png" alt="image-20240331234534060"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234747105.png" alt="image-20240331234747105"></p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234813084.png" alt="image-20240331234813084"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240331234853713.png" alt="image-20240331234853713"></p>
<h2 id="AOF-Append-Only-file"><a href="#AOF-Append-Only-file" class="headerlink" title="AOF(Append Only file)"></a>AOF(Append Only file)</h2><p>如果宕掉了，就load 数据 写回实例里。会以日志的形式记录下每个写的操作，然后将Redis执行过的所有写指令记录下来，（读操作不记录），只允许追加文件不允许改写文件，redis在启动之初会读取该文件重新构建数据。</p>
<p>—&#x3D;&#x3D;redis重启的话就会根据日志文件的内任凭将写指令从前到后执行一次以完成数据的恢复工作&#x3D;&#x3D;</p>
<p>默认情况下使用的AOF，开启AOF功能需要配置appendonly yes</p>
<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401095600434.png" alt="image-20240401095600434"></p>
<h3 id="三种写回策略"><a href="#三种写回策略" class="headerlink" title="三种写回策略"></a>三种写回策略</h3><h4 id="Always"><a href="#Always" class="headerlink" title="Always"></a>Always</h4><h4 id="everysec"><a href="#everysec" class="headerlink" title="everysec"></a>everysec</h4><h4 id="no"><a href="#no" class="headerlink" title="no"></a>no</h4><img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401095655676.png" alt="image-20240401095655676" style="zoom:33%;" />

<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401095950257.png" alt="image-20240401095950257" style="zoom:33%;" />

<h3 id="redis6与redis7"><a href="#redis6与redis7" class="headerlink" title="redis6与redis7"></a>redis6与redis7</h3><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401101931550.png" alt="image-20240401101931550"></p>
<h3 id="优点缺点"><a href="#优点缺点" class="headerlink" title="优点缺点"></a>优点缺点</h3><h4 id="优点：更好的保护数据不被丢失，性能高，可以做紧急恢复"><a href="#优点：更好的保护数据不被丢失，性能高，可以做紧急恢复" class="headerlink" title="优点：更好的保护数据不被丢失，性能高，可以做紧急恢复"></a>优点：更好的保护数据不被丢失，性能高，可以做紧急恢复</h4><ul>
<li>使用AOF redis更加的持久，你可以设计不同的fsync策略（三种写回策略），即使是每秒写入，写入的性能依旧是不错的，fsync是使用后台线程执行的，当没有fsync正在进行的时候，主线程会努力的执行写入，只会丢失一秒钟的写入。</li>
<li>AOF日志是一个仅附加日志，因此不会出现寻道问题，也不会在断电的时候出现损坏的问题，即使由于某种原因，磁盘已经满了或者其他的原因日志以写一般的命令结尾，redis-check-aof也能很轻松的修复。</li>
<li>当AOF变得太大的时候，redis能够在后台重写AOF，重写是完全安全的，因为当redis继续附加到旧文件时，会创建当前数据集所需的最少操作集生成一个全新的文件，一旦第二个文件准备就绪，redis就会切换两者并开始附加到新的那一个。</li>
<li>AOF以易于理解喝解析的格式依次包含所有操作的日志，您甚至可以轻松的导出AOF文件，如歌不小心使用了flushall命令刷新了所有的内容，只要在此期间内没有执行日志重写工作，您仍然可以通过停止服务器，删除最新命令并重新启动redis来保存数据集。</li>
</ul>
<p>打开appendonly.aof.1.incr.aof里面一定有个flushall，把这个命令删掉</p>
<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>相同数据集的数据而言aof文件要远大于rdb文件，恢复速度要慢于rdb</li>
<li>aof运行的效率要慢于rdb，每秒同步策略的效率较好，不同步效率与rdb相同</li>
</ul>
<h4 id="AOF重写机制"><a href="#AOF重写机制" class="headerlink" title="AOF重写机制"></a>AOF重写机制</h4><p>由于AOF持久话是redis不断将写命令记录到AOF文件中，随着redis的不断的进行，AOF的文件就会越来越大，占用的服务器内存越大，以及AOF恢复时间要求越长。</p>
<p>&#x3D;&#x3D;为了解决这个问题，redis新增了重写机制，当AOF的文件的大小超过了所设定的峰值时，redis就会自动的<strong>启动AOF文件内容压缩，只保留恢复数据的最小指令集</strong>，或者<strong>手动使用命令bgrewriteaof</strong>&#x3D;&#x3D;</p>
<p><strong>峰值</strong></p>
<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401104852636.png" alt="image-20240401104852636" style="zoom:33%;" />

<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401104918329.png" alt="image-20240401104918329" style="zoom:33%;" />

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401110224729.png" alt="image-20240401110224729"></p>
<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401110249259.png" alt="image-20240401110249259" style="zoom:33%;" />

<h2 id="RDB-AOP混合持久化"><a href="#RDB-AOP混合持久化" class="headerlink" title="RDB-AOP混合持久化"></a>RDB-AOP混合持久化</h2><p>可以同时共存 ， AOF说的算</p>
<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401111518010.png" alt="image-20240401111518010" style="zoom:33%;" />

<p>在这种情况下，redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存。</p>
<p>设置aof-use-rdbpreamble都值为yes，yes表示开启设置no表示禁用</p>
<p>RDB镜像做全量吃就话，AOF做增量持久化</p>
<img src="../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401130144683.png" style="zoom:33%;" />

<p><img src="/../blog_images/Redis-%E6%8C%81%E4%B9%85%E5%8C%96/image-20240401130628985.png" alt="image-20240401130628985"></p>
<h2 id="纯缓存模式"><a href="#纯缓存模式" class="headerlink" title="纯缓存模式"></a>纯缓存模式</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/31/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/31/Redis/" class="post-title-link" itemprop="url">Redis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-31 17:13:55 / 修改时间：21:11:39" itemprop="dateCreated datePublished" datetime="2024-03-31T17:13:55+08:00">2024-03-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Linux下安装使用Redis"><a href="#Linux下安装使用Redis" class="headerlink" title="Linux下安装使用Redis"></a>Linux下安装使用Redis</h1><p><img src="/../blog_images/Redis/image-20240331183148156.png" alt="image-20240331183148156"></p>
<p><img src="/../blog_images/Redis/image-20240331183151856.png" alt="image-20240331183151856"></p>
<h2 id="1-打开-关闭redis命令"><a href="#1-打开-关闭redis命令" class="headerlink" title="1. 打开&#x2F;关闭redis命令"></a>1. 打开&#x2F;关闭redis命令</h2><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -a <span class="number">123456</span> -p <span class="number">6379</span></span><br><span class="line">quit//退出</span><br><span class="line">redis-cli -a <span class="number">123456</span> shutdown//单实例关闭</span><br><span class="line"> redis-cli -a <span class="number">123456</span> shutdown //多实例关闭</span><br></pre></td></tr></table></figure>

<h1 id="Redis的十大数据结构"><a href="#Redis的十大数据结构" class="headerlink" title="Redis的十大数据结构"></a>Redis的十大数据结构</h1><h2 id="1-String-字符串"><a href="#1-String-字符串" class="headerlink" title="1. String 字符串"></a>1. String 字符串</h2><h2 id="2-List-列表"><a href="#2-List-列表" class="headerlink" title="2.List 列表"></a>2.List 列表</h2><h2 id="3-Hash哈希表"><a href="#3-Hash哈希表" class="headerlink" title="3.Hash哈希表"></a>3.Hash哈希表</h2><h2 id="4-Set集合"><a href="#4-Set集合" class="headerlink" title="4.Set集合"></a>4.Set集合</h2><h2 id="5-ZSet-redis有序集合"><a href="#5-ZSet-redis有序集合" class="headerlink" title="5.ZSet redis有序集合"></a>5.ZSet redis有序集合</h2><h2 id="6-GEO-地理空间"><a href="#6-GEO-地理空间" class="headerlink" title="6.GEO 地理空间"></a>6.GEO 地理空间</h2><h2 id="7-HyperLogLog-基数统计"><a href="#7-HyperLogLog-基数统计" class="headerlink" title="7.HyperLogLog 基数统计"></a>7.HyperLogLog 基数统计</h2><h2 id="8-bitmap位图"><a href="#8-bitmap位图" class="headerlink" title="8.bitmap位图"></a>8.bitmap位图</h2><h2 id="9-bitfield位域"><a href="#9-bitfield位域" class="headerlink" title="9.bitfield位域"></a>9.bitfield位域</h2><h2 id="10-Stream流"><a href="#10-Stream流" class="headerlink" title="10.Stream流"></a>10.Stream流</h2><h1 id="Redis基础操作"><a href="#Redis基础操作" class="headerlink" title="Redis基础操作"></a>Redis基础操作</h1><p><img src="/../blog_images/Redis/image-20240331174848465.png" alt="image-20240331174848465"></p>
<p>del key 是原子的</p>
<p>unlink key 是非阻塞删除</p>
<p>redis默认是16个库，默认使用的是0号库</p>
<p>keepTTL</p>
<p><img src="/../blog_images/Redis/image-20240331181959700.png" alt="image-20240331181959700"></p>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="最常用"><a href="#最常用" class="headerlink" title="最常用"></a>最常用</h3><p>set、get、ttl</p>
<h3 id="同时设置-获取多个键值"><a href="#同时设置-获取多个键值" class="headerlink" title="同时设置&#x2F;获取多个键值"></a>同时设置&#x2F;获取多个键值</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MSET Key value [key value]</span><br><span class="line">MGET key [key ...]</span><br><span class="line">mset/mget/msetnx</span><br><span class="line">msetnx:不存在的时候才创建，此外，这个命令有点像事务的完整性，只有全部成功才会创建</span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/Redis/image-20240331182938441.png" alt="image-20240331182938441"></p>
<p><img src="/../blog_images/Redis/image-20240331183123246.png" alt="image-20240331183123246"></p>
<h3 id="获取指定区间范围内的值"><a href="#获取指定区间范围内的值" class="headerlink" title="获取指定区间范围内的值"></a>获取指定区间范围内的值</h3><h4 id="GETRANGE-k1-0-1"><a href="#GETRANGE-k1-0-1" class="headerlink" title="GETRANGE k1 0 -1"></a>GETRANGE k1 0 -1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GETRANGE k1 0 -1</span><br><span class="line">// 对于string就是获得子串 类似于substring</span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/Redis/image-20240331183849993.png" alt="image-20240331183849993"></p>
<h4 id="SETRANGE-k1-xxyy"><a href="#SETRANGE-k1-xxyy" class="headerlink" title="SETRANGE k1 xxyy"></a>SETRANGE k1 xxyy</h4><p>从第一位开始， 用‘xxyy’全部覆盖</p>
<p><img src="/../blog_images/Redis/image-20240331184034033.png" alt="image-20240331184034033"></p>
<h3 id="数值的增减"><a href="#数值的增减" class="headerlink" title="数值的增减"></a>数值的增减</h3><h4 id="INCR-K1"><a href="#INCR-K1" class="headerlink" title="INCR K1"></a>INCR K1</h4><p>表示自增1</p>
<h4 id="DECR"><a href="#DECR" class="headerlink" title="DECR"></a>DECR</h4><p>表示自减</p>
<h4 id="DECRBY-k1-5"><a href="#DECRBY-k1-5" class="headerlink" title="DECRBY k1 5"></a>DECRBY k1 5</h4><p><img src="/../blog_images/Redis/image-20240331194044855.png" alt="image-20240331194044855"></p>
<p><img src="/../blog_images/Redis/image-20240331194106413.png" alt="image-20240331194106413"></p>
<h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><p><img src="/../blog_images/Redis/image-20240331194142112.png" alt="image-20240331194142112"></p>
<p>之前的sync&#x2F;lock&#x2F;unlock 只能在<strong>一个jvm</strong>中保证加锁，</p>
<p><img src="/../blog_images/Redis/image-20240331194937034.png" alt="image-20240331194937034"></p>
<h4 id="setex-k1-15-hello"><a href="#setex-k1-15-hello" class="headerlink" title="setex k1 15 hello"></a>setex k1 15 hello</h4><p>设置 key 过期时间 value</p>
<img src="../blog_images/Redis/image-20240331195300058.png" alt="image-20240331195300058" style="zoom:50%;" />

<h3 id="getset"><a href="#getset" class="headerlink" title="getset"></a>getset</h3><p>先get再set</p>
<h2 id="List-Redis-列表"><a href="#List-Redis-列表" class="headerlink" title="List Redis 列表"></a>List Redis 列表</h2><p>底层是一个&#x3D;&#x3D;双端链表&#x3D;&#x3D;的结构，大概有40多个亿，主要功能有push&#x2F;pop等，一般用在栈、队列、消息队列等场景中。</p>
<p>left和right都可以加入</p>
<p>如果键不存在，就创建一个新的连别</p>
<p>如果键存在，就新增内容</p>
<p>如果值全部被移除了，对应的键也会消失</p>
<blockquote>
<p>对于两端的操作性能是很强的，对于索引下标的操作中间的节点性能就会比较差</p>
</blockquote>
<h3 id="lpush-rpush-lrange"><a href="#lpush-rpush-lrange" class="headerlink" title="lpush&#x2F;rpush&#x2F;lrange"></a>lpush&#x2F;rpush&#x2F;lrange</h3><p><img src="/../blog_images/Redis/image-20240331201214038.png" alt="image-20240331201214038"></p>
<h3 id="lpop-rpop"><a href="#lpop-rpop" class="headerlink" title="lpop&#x2F;rpop"></a>lpop&#x2F;rpop</h3><p><img src="/../blog_images/Redis/image-20240331201351026.png" alt="image-20240331201351026"></p>
<h3 id="lindex-按照索引的下标获得元素（从上至下）"><a href="#lindex-按照索引的下标获得元素（从上至下）" class="headerlink" title="lindex 按照索引的下标获得元素（从上至下）"></a>lindex 按照索引的下标获得元素（从上至下）</h3><p><img src="/../blog_images/Redis/image-20240331201559339.png" alt="image-20240331201559339"></p>
<h3 id="llen-获取列表中元素的个数"><a href="#llen-获取列表中元素的个数" class="headerlink" title="llen 获取列表中元素的个数"></a>llen 获取列表中元素的个数</h3><h3 id="lrem-key-数字N给定值v1-（删除N个值等于V1的元素）、"><a href="#lrem-key-数字N给定值v1-（删除N个值等于V1的元素）、" class="headerlink" title="lrem key 数字N给定值v1 （删除N个值等于V1的元素）、"></a>lrem key 数字N给定值v1 （删除N个值等于V1的元素）、</h3><img src="../blog_images/Redis/image-20240331201925609.png" alt="image-20240331201925609" style="zoom:50%;" />

<p>删除list1里面三个值为1的元素</p>
<h3 id="ltrim-key-开始index-结束index-，截取指定范围内的值再赋值给key"><a href="#ltrim-key-开始index-结束index-，截取指定范围内的值再赋值给key" class="headerlink" title="ltrim key 开始index 结束index ，截取指定范围内的值再赋值给key"></a>ltrim key 开始index 结束index ，截取指定范围内的值再赋值给key</h3><p><img src="/../blog_images/Redis/image-20240331202135633.png" alt="image-20240331202135633"></p>
<h3 id="rpoplpush-源列表-目的列表"><a href="#rpoplpush-源列表-目的列表" class="headerlink" title="rpoplpush 源列表 目的列表"></a>rpoplpush 源列表 目的列表</h3><p><img src="/../blog_images/Redis/image-20240331202408163.png" alt="image-20240331202408163"></p>
<h3 id="lset-key-index-value"><a href="#lset-key-index-value" class="headerlink" title="lset key index value"></a>lset key index value</h3><p><img src="/../blog_images/Redis/image-20240331202503414.png" alt="image-20240331202503414"></p>
<h3 id="linset-key-before-after-已有的值插入新的值"><a href="#linset-key-before-after-已有的值插入新的值" class="headerlink" title="linset key before &#x2F;after 已有的值插入新的值"></a>linset key before &#x2F;after 已有的值插入新的值</h3><p><img src="/../blog_images/Redis/image-20240331202637152.png" alt="image-20240331202637152"></p>
<h2 id="Hash（）"><a href="#Hash（）" class="headerlink" title="Hash（）"></a>Hash（）</h2><p>kv键值对的结构不变，但是v是一个新的键值对</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String , Map&lt;Object,Object&gt;&gt;</span><br></pre></td></tr></table></figure>



<h3 id="hset-hget-hmset-hmget-hgetall-hdel"><a href="#hset-hget-hmset-hmget-hgetall-hdel" class="headerlink" title="hset&#x2F;hget&#x2F;hmset&#x2F;hmget&#x2F;hgetall&#x2F;hdel"></a>hset&#x2F;hget&#x2F;hmset&#x2F;hmget&#x2F;hgetall&#x2F;hdel</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hset key 字段1 value1 字段2 value2 字段3 value3...</span><br></pre></td></tr></table></figure>

<img src="../blog_images/Redis/image-20240331203248639.png" alt="image-20240331203248639" style="zoom:33%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">没有什么区别</span><br><span class="line">hmset/hmget</span><br></pre></td></tr></table></figure>

<img src="../blog_images/Redis/image-20240331203424491.png" alt="image-20240331203424491" style="zoom:33%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hgetall/hdel</span><br></pre></td></tr></table></figure>

<p>hgetall类似于遍历，hdel就是删掉</p>
<img src="../blog_images/Redis/image-20240331203632378.png" alt="image-20240331203632378" style="zoom:50%;" />

<h3 id="hlen-获取某个key中的全部的数量"><a href="#hlen-获取某个key中的全部的数量" class="headerlink" title="hlen 获取某个key中的全部的数量"></a>hlen 获取某个key中的全部的数量</h3><img src="../blog_images/Redis/image-20240331203807798.png" alt="image-20240331203807798" style="zoom:33%;" />

<h3 id="hexists-key-判断在key里面的某个值的key"><a href="#hexists-key-判断在key里面的某个值的key" class="headerlink" title="hexists key 判断在key里面的某个值的key"></a>hexists key 判断在key里面的某个值的key</h3><p><img src="/../blog_images/Redis/image-20240331203900374.png" alt="image-20240331203900374"></p>
<h3 id="hkeys-hvals"><a href="#hkeys-hvals" class="headerlink" title="hkeys&#x2F;hvals"></a>hkeys&#x2F;hvals</h3><p>罗列key和value</p>
<img src="../blog_images/Redis/image-20240331204001831.png" alt="image-20240331204001831" style="zoom:33%;" />

<h3 id="hincrby-hincrbyfloat"><a href="#hincrby-hincrbyfloat" class="headerlink" title="hincrby&#x2F;hincrbyfloat"></a>hincrby&#x2F;hincrbyfloat</h3><p>增加</p>
<p><img src="/../blog_images/Redis/image-20240331204104566.png" alt="image-20240331204104566"></p>
<p><img src="/../blog_images/Redis/image-20240331204313354.png" alt="image-20240331204313354"></p>
<h3 id="hsetnx-（就是set的性质"><a href="#hsetnx-（就是set的性质" class="headerlink" title="hsetnx （就是set的性质"></a>hsetnx （就是set的性质</h3><p><img src="/../blog_images/Redis/image-20240331204340967.png" alt="image-20240331204340967"></p>
<img src="../blog_images/Redis/image-20240331204227917.png" alt="image-20240331204227917" style="zoom:50%;" />

<p>购物车</p>
<h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>单个值可以有多个value ，但是每个值都不能重复</p>
<p><img src="/../blog_images/Redis/image-20240331204829210.png" alt="image-20240331204829210"></p>
<h3 id="SADD-自动去重"><a href="#SADD-自动去重" class="headerlink" title="SADD 自动去重"></a>SADD 自动去重</h3><p><img src="/../blog_images/Redis/image-20240331205105464.png" alt="image-20240331205105464"></p>
<h3 id="SMEMEBERS-set1遍历"><a href="#SMEMEBERS-set1遍历" class="headerlink" title="SMEMEBERS set1遍历"></a>SMEMEBERS set1遍历</h3><img src="../blog_images/Redis/image-20240331205144592.png" alt="image-20240331205144592" style="zoom:33%;" />



<img src="../blog_images/Redis/image-20240331205332306.png" alt="image-20240331205332306" style="zoom:33%;" />

<h3 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h3><p><img src="/../blog_images/Redis/image-20240331205619186.png" alt="image-20240331205619186"></p>
<p><img src="/../blog_images/Redis/image-20240331205705964.png" alt="image-20240331205705964"></p>
<p><img src="/../blog_images/Redis/image-20240331205758175.png" alt="image-20240331205758175"></p>
<h2 id="Zset（sorted-set-有序集合"><a href="#Zset（sorted-set-有序集合" class="headerlink" title="Zset（sorted set)有序集合"></a>Zset（sorted set)有序集合</h2><h2 id="bitmap"><a href="#bitmap" class="headerlink" title="bitmap"></a>bitmap</h2><h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><h2 id="Stream（redis-版本的MQ）消息中间件"><a href="#Stream（redis-版本的MQ）消息中间件" class="headerlink" title="Stream（redis 版本的MQ）消息中间件"></a>Stream（redis 版本的MQ）消息中间件</h2><blockquote>
<p>MQ 包含Kafka RabbitMQ rocketmq等</p>
<p>先去学了MQ</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/18/Docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/18/Docker/" class="post-title-link" itemprop="url">Docker</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-18 10:53:35 / 修改时间：11:24:16" itemprop="dateCreated datePublished" datetime="2024-03-18T10:53:35+08:00">2024-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">中间件</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、容器"><a href="#一、容器" class="headerlink" title="一、容器"></a>一、容器</h1><h2 id="什么是容器"><a href="#什么是容器" class="headerlink" title="什么是容器"></a>什么是容器</h2><p>将软件打包成标准化单元，以用于开发、交付与部署</p>
<h1 id="二、Docker"><a href="#二、Docker" class="headerlink" title="二、Docker"></a>二、Docker</h1><p><strong>Docker 的镜像提供了除内核外完整的运行时环境，确保了应用运行环境一致性，从而不会再出现 “这段代码在我机器上没问题啊” 这类问题；——一致的运行环境</strong></p>
<p><strong>可以做到秒级、甚至毫秒级的启动时间。大大的节约了开发、测试、部署的时间。——更快速的启动时间</strong></p>
<p><strong>避免公用的服务器，资源会容易受到其他用户的影响。——隔离性</strong></p>
<p><strong>善于处理集中爆发的服务器使用压力；——弹性伸缩，快速扩展</strong></p>
<p><strong>可以很轻易的将在一个平台上运行的应用，迁移到另一个平台上，而不用担心运行环境的变化导致应用无法正常运行的情况。——迁移方便</strong></p>
<p>使用 Docker 可以通过定制应用镜像来实现持续集成、持续交付、部署。——持续交付和部署</p>
<h1 id="三-容器VS虚拟机"><a href="#三-容器VS虚拟机" class="headerlink" title="三 容器VS虚拟机"></a>三 容器VS虚拟机</h1><p>简单来说：容器和虚拟机具有相似的资源隔离和分配优势，但功能有所不同，因为容器虚拟化的是操作系统，而不是硬件，因此容器更容易移植，效率也更高。</p>
<h2 id="3-1-两者对比图"><a href="#3-1-两者对比图" class="headerlink" title="3.1 两者对比图"></a>3.1 两者对比图</h2><p>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</p>
<hr>
<p>传统的虚拟机技术是虚拟出一套硬件之后，在其上运行一套完整的操作系统，然后在该操作系统上再运行所需要的应用进程；而容器内的应用进程直接运行于宿主的内核，容器中没有自己的内核，而且也没有进行硬件虚拟，因此容器要比传统虚拟机更加的轻便。</p>
<p><img src="/../blog_images/Docker/image-20240318111036086.png" alt="image-20240318111036086"></p>
<h2 id="3-2-容器与虚拟机总结"><a href="#3-2-容器与虚拟机总结" class="headerlink" title="3.2 容器与虚拟机总结"></a>3.2 容器与虚拟机总结</h2><p><img src="/../blog_images/Docker/image-20240318111314460.png" alt="image-20240318111314460"></p>
<p><strong>容器是一个应用层抽象，用于将代码和依赖资源打包在一起。</strong> <strong>多个容器可以在同一台机器上运行，共享操作系统内核，但各自作为独立的进程在用户空间中运行</strong> 。与虚拟机相比， <strong>容器占用的空间较少</strong>（容器镜像大小通常只有几十兆），<strong>瞬间就能完成启动</strong> 。</p>
<p><strong>虚拟机 (VM) 是一个物理硬件层抽象，用于将一台服务器变成多台服务器。</strong> 管理程序允许多个 VM 在一台机器上运行。每个 VM 都包含一整套操作系统、一个或多个应用、必要的二进制文件和库资源，因此 <strong>占用大量空间</strong> 。而且 VM <strong>启动也十分缓慢</strong> 。</p>
<p>通过 Docker 官网，我们知道了这么多 Docker 的优势，但是大家也没有必要完全否定虚拟机技术，因为两者有不同的使用场景。<strong>虚拟机更擅长于彻底隔离整个运行环境</strong>。例如，云服务提供商通常采用虚拟机技术隔离不同的用户。而 <strong>Docker 通常用于隔离不同的应用</strong> ，例如前端，后端以及数据库</p>
<h2 id="3-3容器与虚拟机两者是可以共存的"><a href="#3-3容器与虚拟机两者是可以共存的" class="headerlink" title="3.3容器与虚拟机两者是可以共存的"></a>3.3容器与虚拟机两者是可以共存的</h2><p><img src="/../blog_images/Docker/image-20240318111806112.png" alt="image-20240318111806112"></p>
<h1 id="四、Docker基本概念"><a href="#四、Docker基本概念" class="headerlink" title="四、Docker基本概念"></a>四、Docker基本概念</h1><p><strong>Docker 中有非常重要的三个基本概念，理解了这三个概念，就理解了 Docker 的整个生命周期。</strong></p>
<ul>
<li><strong>镜像（Image）</strong></li>
<li><strong>容器（Container）</strong></li>
<li><strong>仓库（Repository）</strong></li>
</ul>
<p>理解了这三个概念，就理解了 Docker 的整个生命周期</p>
<p><img src="/../blog_images/Docker/image-20240318111954221.png" alt="image-20240318111954221"></p>
<h2 id="镜像：一个特殊的文件系统"><a href="#镜像：一个特殊的文件系统" class="headerlink" title="镜像：一个特殊的文件系统"></a>镜像：一个特殊的文件系统</h2><p><strong>操作系统分为内核和用户空间</strong>。对于 Linux 而言，内核启动后，会挂载 root 文件系统为其提供用户空间支持。而 Docker 镜像（Image），就相当于是一个 root 文件系统。</p>
<p><strong>Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。</strong> 镜像不包含任何动态数据，其内容在构建之后也不会被改变。</p>
<p>Docker 设计时，就充分利用 <strong>Union FS</strong> 的技术，&#x3D;&#x3D;将其设计为<strong>分层存储的架构</strong> 。镜像实际是由多层文件系统联合组成。&#x3D;&#x3D;</p>
<p><strong>&#x3D;&#x3D;镜像构建时，会一层层构建，前一层是后一层的基础。每一层构建完就不会再发生改变，后一层上的任何改变只发生在自己这一层。</strong>&#x3D;&#x3D; 比如，删除前一层文件的操作，实际不是真的删除前一层的文件，而是&#x3D;&#x3D;仅在当前层标记为该文件已删除。在最终容器运行的时候，虽然不会看到这个文件，但是实际上该文件会一直跟随镜像。&#x3D;&#x3D;因此，在构建镜像的时候，需要额外小心，每一层尽量只包含该层需要添加的东西，任何额外的东西应该在该层构建结束前清理掉。</p>
<p>分层存储的特征还使得镜像的复用、定制变的更为容易。甚至可以&#x3D;&#x3D;用之前构建好的镜像作为基础层&#x3D;&#x3D;，然后进一步添加新的层，以定制自己所需的内容，构建新的镜像。</p>
<h2 id="容器-镜像运行时的实体"><a href="#容器-镜像运行时的实体" class="headerlink" title="容器:镜像运行时的实体"></a>容器:镜像运行时的实体</h2><p><strong>Docker Registry 公开服务</strong> 是开放给用户使用、允许用户管理镜像的 Registry 服务。一般这类公开服务允许用户免费上传、下载公开的镜像，并可能提供收费服务供用户管理私有镜像。</p>
<p>最常使用的 Registry 公开服务是官方的 <strong>Docker Hub</strong> ，这也是默认的 Registry，并拥有大量的高质量的官方镜像，网址为：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/open in new window</a> 。官方是这样介绍 Docker Hub 的</p>
<hr>
<p>著作权归JavaGuide(javaguide.cn)所有 基于MIT协议 原文链接：<a target="_blank" rel="noopener" href="https://javaguide.cn/tools/docker/docker-intro.html">https://javaguide.cn/tools/docker/docker-intro.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/17/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/17/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/" class="post-title-link" itemprop="url">Java微服务3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-17 21:42:41" itemprop="dateCreated datePublished" datetime="2024-03-17T21:42:41+08:00">2024-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-18 13:54:48" itemprop="dateModified" datetime="2024-03-18T13:54:48+08:00">2024-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">Java体系知识</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">微服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="服务保护和分布式事务"><a href="#服务保护和分布式事务" class="headerlink" title="服务保护和分布式事务"></a>服务保护和分布式事务</h1><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317214812012.png" alt="image-20240317214812012">有个服务很高 一个服务就所有的线程和进程全占了</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317215027907.png" alt="image-20240317215027907"></p>
<h2 id="雪崩问题"><a href="#雪崩问题" class="headerlink" title="雪崩问题"></a>雪崩问题</h2><p>微服务调用链路中的某个服务故障，引起整个链路中的所有微服务都不可用，这就是雪崩。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317215511651.png" alt="image-20240317215511651"></p>
<h3 id="雪崩问题产生的原因是什么？"><a href="#雪崩问题产生的原因是什么？" class="headerlink" title="雪崩问题产生的原因是什么？"></a>雪崩问题产生的原因是什么？</h3><ul>
<li>微服务相互调用，服务提供者出现故障或阻塞。</li>
<li>服务调用者没有做好异常处理，导致自身故障。</li>
<li>调用链中的所有服务级联失败，导致整个集群故障</li>
</ul>
<h3 id="解决问题的思路有哪些？"><a href="#解决问题的思路有哪些？" class="headerlink" title="解决问题的思路有哪些？"></a>解决问题的思路有哪些？</h3><ul>
<li>尽量避免服务出现故障或阻塞。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">保证代码的健壮性；</span><br><span class="line"></span><br><span class="line">保证网络畅通；</span><br><span class="line"></span><br><span class="line">能应对较高的并发请求；</span><br></pre></td></tr></table></figure>

<ul>
<li>服务调用者做好远程调用异常的后备方案，避免故障扩散</li>
</ul>
<h3 id="服务保护方案"><a href="#服务保护方案" class="headerlink" title="服务保护方案"></a>服务保护方案</h3><h4 id="请求限流"><a href="#请求限流" class="headerlink" title="- 请求限流"></a>- 请求限流</h4><p>限制访问接口的请求的并发量，避免服务因流量激增出现故障。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317220549992.png" alt="image-20240317220549992"></p>
<h4 id="线程隔离"><a href="#线程隔离" class="headerlink" title="线程隔离"></a>线程隔离</h4><p>线程隔离：也叫做舱壁模式，模拟船舱隔板的防水原理。通过限定每个业务能使用的线程数量而将故障业务隔离，避免故障扩散。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317220702031.png" alt="image-20240317220702031"></p>
<h3 id="服务熔断"><a href="#服务熔断" class="headerlink" title="服务熔断"></a>服务熔断</h3><p>服务熔断：由<strong>断路器</strong>统计请求的异常比例或慢&#x3D;&#x3D;调用比例&#x3D;&#x3D;，如果超出阈值则会<strong>熔断</strong>该业务，则拦截该接口的请求。</p>
<p>熔断期间，所有请求快速失败，全都走fallback逻辑。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317223937333.png" alt="image-20240317223937333"></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><strong>请求限流</strong>：限制流量在服务可以处理的范围，避免因突发流量而故障</p>
<p><strong>线程隔离</strong>：控制业务可用的线程数量，将故障隔离在一定范围</p>
<p><strong>失败处理</strong>：定义fallback逻辑，让业务失败时不再抛出异常，而是走fallback逻辑</p>
<p><strong>服务熔断</strong>：将异常比例过高的接口断开，拒绝所有请求，直接走fallback</p>
<h3 id="服务保护技术"><a href="#服务保护技术" class="headerlink" title="服务保护技术"></a>服务保护技术</h3><table>
<thead>
<tr>
<th></th>
<th><strong>Sentinel</strong></th>
<th><strong>Hystrix</strong></th>
</tr>
</thead>
<tbody><tr>
<td>线程隔离</td>
<td>信号量隔离</td>
<td>线程池隔离&#x2F;信号量隔离</td>
</tr>
<tr>
<td>熔断策略</td>
<td>基于慢调用比例或异常比例</td>
<td>基于异常比率</td>
</tr>
<tr>
<td>限流</td>
<td>基于 QPS，支持流量整形</td>
<td>有限的支持</td>
</tr>
<tr>
<td>Fallback</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>控制台</td>
<td>开箱即用，可配置规则、查看秒级监控、机器发现等</td>
<td>不完善</td>
</tr>
<tr>
<td>配置方式</td>
<td>基于控制台，重启后失效</td>
<td>基于注解或配置文件，永久生效</td>
</tr>
</tbody></table>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>Sentinel是阿里巴巴开源的一款微服务流量控制组件。官网地址：<a target="_blank" rel="noopener" href="https://sentinelguard.io/zh-cn/index.html"> https://sentinelguard.io/zh-cn/index.html</a></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317224540969.png" alt="image-20240317224540969"></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="step1-导包"><a href="#step1-导包" class="headerlink" title="step1 导包"></a>step1 导包</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317224630323.png" alt="image-20240317224630323"></p>
<h4 id="step2-配置控制台"><a href="#step2-配置控制台" class="headerlink" title="step2 配置控制台"></a>step2 配置控制台</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317224644608.png" alt="image-20240317224644608"></p>
<h4 id="step3-重启访问"><a href="#step3-重启访问" class="headerlink" title="step3 重启访问"></a>step3 重启访问</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317224807401.png" alt="image-20240317224807401"></p>
<h3 id="簇点链路"><a href="#簇点链路" class="headerlink" title="簇点链路"></a><strong>簇点链路</strong></h3><p>就是单机调用链路。是一次请求进入服务后经过的每一个被Sentinel监控的资源链。默认Sentinel会监控SpringMVC的每一个Endpoint（http接口）。限流、熔断等都是针对簇点链路中的<strong>资源</strong>设置的。而资源名默认就是接口的请求路径：</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317224937069.png" alt="image-20240317224937069"></p>
<p>熔断什么的都是针对簇点资源做的</p>
<p>Restful风格的API请求路径一般都相同，这会导致簇点资源名称重复。因此我们要修改配置，把<strong>请求方式+请求路径</strong>作为簇点资源名称：</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240317225139867.png" alt="image-20240317225139867"></p>
<h2 id="分布式事务"><a href="#分布式事务" class="headerlink" title="分布式事务"></a>分布式事务</h2><p>在分布式系统中，如果一个业务需要多个服务合作完成，而且每一个服务都有事务，&#x3D;&#x3D;多个事务必须同时成功或失败，这样的事务就是<strong>分布式事务</strong>。其中的每个服务的事务就是一个<strong>分支事务</strong>。整个业务称为<strong>全局事务</strong>。&#x3D;&#x3D;</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240318095044645.png" alt="image-20240318095044645"></p>
<h3 id="初识Seata"><a href="#初识Seata" class="headerlink" title="初识Seata"></a>初识Seata</h3><p>解决分布式事务，各个子事务之间必须能感知到彼此的事务状态，才能保证状态一致。</p>
<p>Seata事务管理中有三个重要的角色：</p>
<p>•<strong>TC (Transaction Coordinator) -</strong> <strong>事务协调者：</strong>维护全局和分支事务的状态，协调全局事务提交或回滚。</p>
<p>•<strong>TM (Transaction Manager) -</strong> <strong>事务管理器：</strong>定义全局事务的范围、开始全局事务、提交或回滚全局事务。</p>
<p>•<strong>RM (Resource Manager) -</strong> <strong>资源管理器：</strong>管理分支事务，与TC交谈以注册分支事务和报告分支事务的状态</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A13/image-20240318095501708.png" alt="image-20240318095501708"></p>
<h3 id="部署TC服务"><a href="#部署TC服务" class="headerlink" title="部署TC服务"></a>部署TC服务</h3><h3 id="微服务集成Seata"><a href="#微服务集成Seata" class="headerlink" title="微服务集成Seata"></a>微服务集成Seata</h3><h3 id="XA模式"><a href="#XA模式" class="headerlink" title="XA模式"></a>XA模式</h3><h3 id="AT模式"><a href="#AT模式" class="headerlink" title="AT模式"></a>AT模式</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/16/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/16/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/" class="post-title-link" itemprop="url">Java微服务2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-16 11:24:42" itemprop="dateCreated datePublished" datetime="2024-03-16T11:24:42+08:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-17 21:43:49" itemprop="dateModified" datetime="2024-03-17T21:43:49+08:00">2024-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">Java体系知识</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">微服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h1><p>把项目拆分成了多个部分，在进行交换的时候，如何验证安全性和yjwt这些呢？</p>
<p>如果每个都分发密钥的话，又会存在风险</p>
<p><strong>网关</strong>：就是网络的关口，负责请求的路由、转发、身份校验。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317102541199.png" alt="image-20240317102541199"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317102936133.png" alt="image-20240317102936133"></p>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><h3 id="step1-创建新模块"><a href="#step1-创建新模块" class="headerlink" title="step1 创建新模块"></a>step1 创建新模块</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317103308256.png" alt="image-20240317103308256"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317104815549.png" alt="image-20240317104815549"></p>
<h3 id="step2-引入网关依赖"><a href="#step2-引入网关依赖" class="headerlink" title="step2 引入网关依赖"></a>step2 引入网关依赖</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring:</span>  </span><br><span class="line">	<span class="string">cloud:</span>    </span><br><span class="line">	<span class="string">gateway:</span>      </span><br><span class="line">		<span class="attr">routes:</span>         </span><br><span class="line">			<span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item</span> <span class="comment"># 路由规则id，自定义，唯一 </span></span><br><span class="line">            <span class="attr">uri:</span> <span class="string">lb://item-service</span> <span class="comment"># 路由目标微服务，lb代表负载均衡     </span></span><br><span class="line">            <span class="attr">predicates:</span> <span class="comment"># 路由断言，判断请求是否符合规则，符合则路由到目标            - </span></span><br><span class="line">            	<span class="string">Path=/items/**</span> <span class="comment"># 以请求路径做判断，以/items开头则符合</span></span><br><span class="line">        	<span class="bullet">-</span> <span class="attr">id:</span> <span class="string">xx</span>       </span><br><span class="line">            <span class="attr">uri:</span> <span class="string">lb://xx-service</span>     </span><br><span class="line">            <span class="string">predicates:</span>       </span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/xx/**</span></span><br></pre></td></tr></table></figure>

<h3 id="step3-编写启动类"><a href="#step3-编写启动类" class="headerlink" title="step3 编写启动类"></a>step3 编写启动类</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317104833164.png" alt="image-20240317104833164"></p>
<h3 id="step4-配置路由规则"><a href="#step4-配置路由规则" class="headerlink" title="step4 配置路由规则"></a>step4 配置路由规则</h3><p>去resources 配置,在</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server：</span></span><br><span class="line">	<span class="string">port：8080</span></span><br><span class="line"><span class="string">前端请求发出，发给网关</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">application:</span></span><br><span class="line">		<span class="string">name:gateway</span></span><br><span class="line">	<span class="attr">cloud:</span></span><br><span class="line">		<span class="attr">nacos:</span></span><br><span class="line">			<span class="string">server-addr:192.168.150.101:8848//这个就是nacos的安装地址</span></span><br><span class="line">		<span class="string">gateway：</span></span><br><span class="line">			<span class="string">routes：</span></span><br><span class="line">				<span class="string">-id：item-service</span></span><br><span class="line">				<span class="string">路由的唯一标识，服务名字。应该是那个微服务的yaml写的</span></span><br><span class="line">				<span class="string">uri：lb://item-service(lb表示协议名字)</span></span><br><span class="line">				<span class="string">predicates：</span></span><br><span class="line">					<span class="string">-Path=/item/**，/search/**</span></span><br><span class="line">	</span><br><span class="line">				<span class="string">-id:</span> <span class="string">user-service</span></span><br><span class="line">				<span class="string">uri:lb://user-service</span></span><br><span class="line">				<span class="attr">predicates:</span></span><br><span class="line">					<span class="string">-Path=/addresses/**,/users/**</span></span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317111829319.png" alt="image-20240317111829319"></p>
<h2 id="路由属性"><a href="#路由属性" class="headerlink" title="路由属性"></a>路由属性</h2><p><strong>网关路由</strong>对应的Java类型是RouteDefinition，其中常见的属性有：</p>
<ul>
<li>id：路由唯一标示</li>
<li>uri：路由目标地址</li>
<li>predicates：路由断言，判断请求是否符合当前路由。</li>
<li>filters：路由过滤器，对请求或响应做特殊处理。</li>
</ul>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317142249280.png" alt="image-20240317142249280"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317142344314.png" alt="image-20240317142344314"></p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>After</td>
<td>是某个时间点后的请求</td>
<td>-  After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Before</td>
<td>是某个时间点之前的请求</td>
<td>-  Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td>
</tr>
<tr>
<td>Between</td>
<td>是某两个时间点之前的请求</td>
<td>-  Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver],  2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Cookie</td>
<td>请求必须包含某些cookie</td>
<td>- Cookie&#x3D;chocolate, ch.p</td>
</tr>
<tr>
<td>Header</td>
<td>请求必须包含某些header</td>
<td>- Header&#x3D;X-Request-Id, \d+</td>
</tr>
<tr>
<td>Host</td>
<td>请求必须是访问某个host（域名）</td>
<td>-  Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td>
</tr>
<tr>
<td>Method</td>
<td>请求方式必须是指定方式</td>
<td>- Method&#x3D;GET,POST</td>
</tr>
<tr>
<td>Path</td>
<td>请求路径必须符合指定规则</td>
<td>- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td>
</tr>
<tr>
<td>Query</td>
<td>请求参数必须包含指定参数</td>
<td>- Query&#x3D;name, Jack或者-  Query&#x3D;name</td>
</tr>
<tr>
<td>RemoteAddr</td>
<td>请求者的ip必须是指定范围</td>
<td>- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td>
</tr>
<tr>
<td>Weight</td>
<td>权重处理</td>
<td>- Weight&#x3D;group1, 2</td>
</tr>
<tr>
<td>XForwarded Remote Addr</td>
<td>基于请求的来源IP做判断</td>
<td>- XForwardedRemoteAddr&#x3D;192.168.1.1&#x2F;24</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th><strong>AddRequestHeader</strong></th>
<th><strong>给当前请求添加一个请求头</strong></th>
<th><strong>AddrequestHeader&#x3D;headerName,headerValue</strong></th>
</tr>
</thead>
<tbody><tr>
<td>RemoveRequestHeader</td>
<td>移除请求中的一个请求头</td>
<td>RemoveRequestHeader&#x3D;headerName</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>给响应结果中添加一个响应头</td>
<td>AddResponseHeader&#x3D;headerName,headerValue</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>从响应结果中移除有一个响应头</td>
<td>RemoveResponseHeader&#x3D;headerName</td>
</tr>
<tr>
<td>RewritePath</td>
<td>请求路径重写</td>
<td>RewritePath&#x3D;&#x2F;red&#x2F;?(?<segment>.*),  &#x2F;${segment}</td>
</tr>
<tr>
<td>StripPrefix</td>
<td>去除请求路径中的N段前缀</td>
<td>StripPrefix&#x3D;1，则路径&#x2F;a&#x2F;b转发时只保留&#x2F;b</td>
</tr>
</tbody></table>
<h2 id="网关登录校验"><a href="#网关登录校验" class="headerlink" title="网关登录校验"></a>网关登录校验</h2><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317152011836.png" alt="image-20240317152011836"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317144533991.png" alt="image-20240317144533991"></p>
<ul>
<li><p>如何在网关转发之前做登录校验？</p>
</li>
<li><p>网关如何将用户信息传递给微服务？</p>
</li>
<li><p>如何在微服务之间传递用户信息？</p>
</li>
</ul>
<p>在最开始的pre部分就进行JWT校验，然后保存到请求头，因为网关和微服务的联系是http协议的，用保存到请求头是最方便的</p>
<h2 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h2><h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><p>网关过滤器有两种，分别是：</p>
<ul>
<li><p>GatewayFilter：路由过滤器，作用于任意指定的路由；默认不生效，要配置到路由后生效。</p>
</li>
<li><p>GlobalFilter：全局过滤器，作用范围是所有路由；声明后自动生效。</p>
</li>
</ul>
<p>两种过滤器的<strong>过滤方法</strong>签名完全一致：</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317152329925.png" alt="image-20240317152329925"></p>
<h3 id="GlobalFilter步骤"><a href="#GlobalFilter步骤" class="headerlink" title="GlobalFilter步骤"></a>GlobalFilter步骤</h3><h4 id="step1自定义过滤器"><a href="#step1自定义过滤器" class="headerlink" title="step1自定义过滤器"></a>step1自定义过滤器</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317153953039.png" alt="image-20240317153953039"></p>
<h4 id="step2保证过滤器在nettyroutingfilter前执行"><a href="#step2保证过滤器在nettyroutingfilter前执行" class="headerlink" title="step2保证过滤器在nettyroutingfilter前执行"></a>step2保证过滤器在nettyroutingfilter前执行</h4><blockquote>
<p>ctrl h</p>
</blockquote>
<p>nettyroutingfilter 实现了globalfilter 、ordered</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317154417252.png" alt="image-20240317154417252"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317154550771.png" alt="image-20240317154550771"></p>
<h3 id="GatewayFilter开发比较麻烦"><a href="#GatewayFilter开发比较麻烦" class="headerlink" title="GatewayFilter开发比较麻烦"></a>GatewayFilter开发比较麻烦</h3><h2 id="实现登录校验"><a href="#实现登录校验" class="headerlink" title="实现登录校验"></a>实现登录校验</h2><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161207641.png" alt="image-20240317161207641"></p>
<h3 id="获取request"><a href="#获取request" class="headerlink" title="获取request"></a>获取request</h3><h3 id="判断是否需要做登记"><a href="#判断是否需要做登记" class="headerlink" title="判断是否需要做登记"></a>判断是否需要做登记</h3><h3 id="获取token"><a href="#获取token" class="headerlink" title="获取token"></a>获取token</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161043431.png" alt="image-20240317161043431"></p>
<h3 id="校验并解析token"><a href="#校验并解析token" class="headerlink" title="校验并解析token"></a>校验并解析token</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161242789.png" alt="image-20240317161242789"></p>
<h3 id="传递用户信息"><a href="#传递用户信息" class="headerlink" title="传递用户信息"></a>传递用户信息</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161231553.png" alt="image-20240317161231553"></p>
<h3 id="放行"><a href="#放行" class="headerlink" title="放行"></a>放行</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161224211.png" alt="image-20240317161224211"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317161216758.png" alt="image-20240317161216758"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317175833120.png" alt="image-20240317175833120"></p>
<h2 id="实现登录校验-1"><a href="#实现登录校验-1" class="headerlink" title="实现登录校验"></a>实现登录校验</h2><p>一、在网关的登录校验过滤器中，把获取到的用户写入请求头</p>
<p><strong>需求：</strong>修改gateway模块中的登录校验拦截器，在校验成功后保存用户到下游请求的请求头中。<br><strong>提示：</strong>要修改转发到微服务的请求，需要用到ServerWebExchange类提供的API，示例如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exchange.mutate() // mutate就是对下游请求做更改        </span><br><span class="line">	.request(builder -&gt; builder.header(&quot;user-info&quot;, userInfo)) </span><br><span class="line">	.build();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317203444339.png" alt="image-20240317203444339"></p>
<h2 id="OpenFeign传递用户"><a href="#OpenFeign传递用户" class="headerlink" title="OpenFeign传递用户"></a>OpenFeign传递用户</h2><p>OpenFeign中提供了一个拦截器接口，所有由OpenFeign发起的请求都会先调用拦截器处理请求：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RequestInterceptor</span> &#123;  <span class="comment">/**   * Called for every request. Add data using methods on the supplied &#123;<span class="doctag">@link</span> RequestTemplate&#125;.   */</span>  </span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(RequestTemplate template)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中的RequestTemplate类中提供了一些方法可以让我们修改请求头：</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317204509497.png" alt="image-20240317204509497"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317205048040.png" alt="image-20240317205048040"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317205446309.png" alt="image-20240317205446309"></p>
<h1 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h1><p>微服务重复配置过多，维护成本高</p>
<p>业务配置经常变动，每次修改都要重启服务</p>
<p>网关路由配置写死，如果变更要重启网关</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317205539196.png" alt="image-20240317205539196"></p>
<p>监听配置的变更，变更了就推送给相应的微服务</p>
<p>实现配置的热更新</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317205830739.png" alt="image-20240317205830739"></p>
<h2 id="配置共享"><a href="#配置共享" class="headerlink" title="配置共享"></a>配置共享</h2><h3 id="一．添加配置到Nacos"><a href="#一．添加配置到Nacos" class="headerlink" title="一．添加配置到Nacos"></a>一．添加配置到Nacos</h3><p>添加一些共享配置到Nacos中，包括：Jdbc、MybatisPlus、日志、Swagger、OpenFeign等配置</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317210450372.png" alt="image-20240317210450372"></p>
<p>添加一些共享配置到Nacos中，包括：Jdbc、MybatisPlus、日志、Swagger、OpenFeign等配置</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317210509795.png" alt="image-20240317210509795"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317210623417.png" alt="image-20240317210623417"></p>
<h3 id="二．拉取共享配置"><a href="#二．拉取共享配置" class="headerlink" title="二．拉取共享配置"></a>二．拉取共享配置</h3><p>基于NacosConfig拉取共享配置代替微服务的本地配置。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317211045349.png" alt="image-20240317211045349"></p>
<h4 id="①引入依赖"><a href="#①引入依赖" class="headerlink" title="①引入依赖"></a>①引入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos配置管理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span><span class="comment">&lt;!--读取bootstrap文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>   </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="②新建bootstrap-yaml"><a href="#②新建bootstrap-yaml" class="headerlink" title="②新建bootstrap.yaml"></a>②新建bootstrap.yaml</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317211200919.png" alt="image-20240317211200919"></p>
<h2 id="配置热更新"><a href="#配置热更新" class="headerlink" title="配置热更新"></a>配置热更新</h2><p><strong>配置热更新：</strong>当修改配置文件中的配置时，微服务无需重启即可使配置生效。</p>
<p><strong>前提条件：</strong></p>
<p>①nacos中要有一个与微服务名有关的配置文件。</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317212050543.png" alt="image-20240317212050543"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317211842338.png" alt="image-20240317211842338"></p>
<p>②微服务中要以特定方式读取需要热更新的配置属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;hm.cart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartProperties</span> &#123;    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> maxItems;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartProperties</span> &#123;    <span class="meta">@Value(&quot;$&#123;hm.cart.maxItems&#125;&quot;)</span></span><br><span class="line"> <span class="keyword">private</span> <span class="type">int</span> maxItems;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317212735592.png" alt="image-20240317212657760"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317212751287.png" alt="image-20240317212751287"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317213403685.png" alt="image-20240317213403685"></p>
<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><p>实现动态路由需要将<strong>路由配置保存到Nacos</strong>，然后在网关监听Nacos中的路由配置，并实现配置热更新。然而网关路由并不是自定义业务配置属性，本身不具备热更新功能！参考：CompositeRouteDefinitionLocator</p>
<p>因此我们需要自己完成两件事情：</p>
<p>①监听Nacos配置变更的消息</p>
<p>②当配置变更时，将最新的路由信息更新到网关路由表</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317214014466.png" alt="image-20240317214014466"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317214021404.png" alt="image-20240317214021404"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A12/image-20240317214029557.png" alt="image-20240317214029557"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/14/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/14/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/" class="post-title-link" itemprop="url">Java微服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-14 20:23:03" itemprop="dateCreated datePublished" datetime="2024-03-14T20:23:03+08:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-16 11:23:43" itemprop="dateModified" datetime="2024-03-16T11:23:43+08:00">2024-03-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">Java体系知识</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" itemprop="url" rel="index"><span itemprop="name">微服务</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314203146347.png" alt="image-20240314203146347"></p>
<h1 id="微服务01"><a href="#微服务01" class="headerlink" title="微服务01"></a>微服务01</h1><blockquote>
<p>微服务：一种软件架构风格，他是专注于单一职责的很多小型项目为基础，组合出复杂的大型项目</p>
</blockquote>
<h2 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h2><p>将业务的所有功能都集中在一个项目中开发，打包成一个包部署</p>
<h3 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h3><p>架构简单；部署成本低</p>
<h3 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h3><p>团队协作成本高；系统的发布效率低；系统可用性差</p>
<h2 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h2><p>微服务架构，是<strong>服务化思想指导下的一套最佳实践架构方案。</strong></p>
<p>服务化，**&#x3D;&#x3D;就是把单体架构中的功能模块拆分为多个独立项目。&#x3D;&#x3D;**</p>
<ul>
<li><p>粒度小</p>
</li>
<li><p>团队自治</p>
</li>
<li><p>服务自治：分别编译打包；分别部署；数据隔离</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314205902699.png" alt="image-20240314205902699"></p>
</li>
</ul>
<h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><p>SpringCloud是目前国内使用最广泛的微服务框架。官网地址：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud%E3%80%82">https://spring.io/projects/spring-cloud。</a></p>
<p>SpringCloud集成了各种微服务功能组件，并基于SpringBoot实现了这些组件的自动装配，从而提供了良好的开箱即用体验：</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314211045953.png" alt="image-20240314211045953"></p>
<table>
<thead>
<tr>
<th><strong>SpringCloud****版本</strong></th>
<th><strong>SpringBoot****版本</strong></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2022.0-Release-Notes">2022.0.x</a> aka Kilburn</td>
<td>3.0.x</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2021.0-Release-Notes">2021.0.x</a></strong> <strong>aka Jubilee</strong></td>
<td><strong>2.6.x, 2.7.x (Starting with  2021.0.3)</strong></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-2020.0-Release-Notes">2020.0.x</a> aka Ilford</td>
<td>2.4.x, 2.5.x (Starting with  2020.0.3)</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-release/wiki/Spring-Cloud-Hoxton-Release-Notes">Hoxton</a></td>
<td>2.2.x, 2.3.x (Starting with SR5)</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Greenwich-Release-Notes">Greenwich</a></td>
<td>2.1.x</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Finchley-Release-Notes">Finchley</a></td>
<td>2.0.x</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Edgware-Release-Notes">Edgware</a></td>
<td>1.5.x</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-cloud/wiki/Spring-Cloud-Dalston-Release-Notes">Dalston</a></td>
<td>1.5.x</td>
</tr>
</tbody></table>
<h2 id="微服务拆分"><a href="#微服务拆分" class="headerlink" title="微服务拆分"></a>微服务拆分</h2><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314211735588.png" alt="image-20240314211735588"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314211911736.png" alt="image-20240314211911736"></p>
<h3 id="服务拆分原则"><a href="#服务拆分原则" class="headerlink" title="服务拆分原则"></a>服务拆分原则</h3><h4 id="什么时候拆分"><a href="#什么时候拆分" class="headerlink" title="什么时候拆分"></a><strong>什么时候拆分</strong></h4><p>创业型项目：先采用单体架构，快速开发，快速试错。随着规模扩大，逐渐拆分。</p>
<p>确定的大型项目：资金充足，目标明确，可以直接选择微服务架构，避免后续拆分的麻烦。</p>
<h4 id="怎么拆分"><a href="#怎么拆分" class="headerlink" title="怎么拆分"></a><strong>怎么拆分</strong></h4><p>从拆分目标来说，要做到：</p>
<ul>
<li><strong>高内聚</strong>：每个微服务的职责要尽量单一，包含的业务相互关联度高、完整度高。</li>
<li><strong>低耦合</strong>：每个微服务的功能要相对独立，尽量减少对其它微服务的依赖。</li>
</ul>
<p>从拆分方式来说，一般包含两种方式：</p>
<ul>
<li><strong>纵向拆分</strong>：按照业务模块来拆分</li>
<li><strong>横向拆分</strong>：抽取公共服务，提高复用性</li>
</ul>
<h3 id="拆分服务"><a href="#拆分服务" class="headerlink" title="拆分服务"></a>拆分服务</h3><p>独立project</p>
<p>Maven聚合</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240314214402573.png" alt="image-20240314214402573"></p>
<p>dto ：表单交互 </p>
<h3 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h3><p>Spring给我们提供了一个RestTemplate工具，可以方便的实现Http请求的发送。使用步骤如下：</p>
<p>①注入RestTemplate到Spring容器</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315141015868.png" alt="image-20240315141015868"></p>
<p>②发起远程调用</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315141033725.png" alt="image-20240315141033725"></p>
<p>requestArgsConstructor注解 ，对于所有的final的字段创建构造函数</p>
<h2 id="服务治理"><a href="#服务治理" class="headerlink" title="服务治理"></a>服务治理</h2><h3 id="服务远程调用时存在的问题"><a href="#服务远程调用时存在的问题" class="headerlink" title="服务远程调用时存在的问题"></a>服务远程调用时存在的问题</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315151455307.png" alt="image-20240315151455307"></p>
<p>在远程调用的时候，不知道调哪个服务器，如果那个服务器挂了也不知道怎么换</p>
<h2 id="注册中心原理"><a href="#注册中心原理" class="headerlink" title="注册中心原理"></a>注册中心原理</h2><h4 id="所有的服务提供者都会在注册中心注册，然后当服务调用者要调用的时候，就会把注册的信息传输过去；"><a href="#所有的服务提供者都会在注册中心注册，然后当服务调用者要调用的时候，就会把注册的信息传输过去；" class="headerlink" title="所有的服务提供者都会在注册中心注册，然后当服务调用者要调用的时候，就会把注册的信息传输过去；"></a>所有的服务提供者都会在注册中心注册，然后当服务调用者要调用的时候，就会把注册的信息传输过去；</h4><h4 id="为了实现负载均衡，可能使用了轮询等"><a href="#为了实现负载均衡，可能使用了轮询等" class="headerlink" title="为了实现负载均衡，可能使用了轮询等"></a>为了实现负载均衡，可能使用了轮询等</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315152502417.png" alt="image-20240315152502417"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315152553563.png" alt="image-20240315152553563"></p>
<h4 id="心跳续约"><a href="#心跳续约" class="headerlink" title="心跳续约"></a>心跳续约</h4><p>所有的服务都会定期和注册中心请求一下，说明自己还活着</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><h5 id="服务治理中的三个角色分别是什么？"><a href="#服务治理中的三个角色分别是什么？" class="headerlink" title="服务治理中的三个角色分别是什么？"></a>服务治理中的三个角色分别是什么？</h5><p>​	&#x3D;&#x3D;服务提供者：暴露服务接口，供其它服务调用&#x3D;&#x3D;</p>
<p>​	&#x3D;&#x3D;服务消费者：调用其它服务提供的接口&#x3D;&#x3D;</p>
<p>​	&#x3D;&#x3D;注册中心：记录并监控微服务各实例状态，推送服务变更信息&#x3D;&#x3D;</p>
<h5 id="消费者如何知道提供者的地址？"><a href="#消费者如何知道提供者的地址？" class="headerlink" title="消费者如何知道提供者的地址？"></a>消费者如何知道提供者的地址？</h5><p>​	服务提供者会在启动时注册自己信息到注册中心，消费者可以从注册中心订阅和拉取服务信息</p>
<h5 id="消费者如何得知服务状态变更？"><a href="#消费者如何得知服务状态变更？" class="headerlink" title="消费者如何得知服务状态变更？"></a>消费者如何得知服务状态变更？</h5><p>​	服务提供者通过心跳机制向注册中心报告自己的健康状态，当心跳异常时注册中心会将异常服务剔除，并通知订阅了该服务的消费者</p>
<h5 id="当提供者有多个实例时，消费者该选择哪一个？"><a href="#当提供者有多个实例时，消费者该选择哪一个？" class="headerlink" title="当提供者有多个实例时，消费者该选择哪一个？"></a>当提供者有多个实例时，消费者该选择哪一个？</h5><p>​	&#x3D;&#x3D;消费者可以通过负载均衡算法，从多个实例中选择一个&#x3D;&#x3D;</p>
<h2 id="Nacos注册中心"><a href="#Nacos注册中心" class="headerlink" title="Nacos注册中心"></a>Nacos注册中心</h2><blockquote>
<p>Nacos是目前国内企业中占比最多的注册中心组件。它是阿里巴巴的产品，目前已经加入SpringCloudAlibaba中。</p>
</blockquote>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315154400243.png" alt="image-20240315154400243"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315155652332.png" alt="image-20240315155652332"></p>
<h2 id="服务注册"><a href="#服务注册" class="headerlink" title="服务注册"></a>服务注册</h2><blockquote>
<p>服务注册步骤如下：</p>
</blockquote>
<h3 id="①引入nacos-discovery依赖："><a href="#①引入nacos-discovery依赖：" class="headerlink" title="①引入nacos discovery依赖："></a>①引入nacos discovery依赖：</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315160950577.png" alt="image-20240315160950577"></p>
<h3 id="②配置Nacos地址"><a href="#②配置Nacos地址" class="headerlink" title="②配置Nacos地址"></a>②配置Nacos地址</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315160955964.png" alt="image-20240315160955964"></p>
<p>注意：每个微服务都要进行一个注册</p>
<p>在idea里配置多个启动项就能实现多个服务</p>
<blockquote>
<p>用云服务器的话，记得把三个端口全部开放：8848、9848、9849，要不然会报错</p>
</blockquote>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315161713629.png" alt="image-20240315161713629"></p>
<h2 id="服务发现"><a href="#服务发现" class="headerlink" title="服务发现"></a>服务发现</h2><p><strong>消费者</strong>需要连接nacos以拉取和订阅服务，因此服务发现的前两步与服务注册是一样，后面再加上服务调用即可：</p>
<p>①引入nacos discovery依赖</p>
<p>… </p>
<p>②配置nacos地址</p>
<p>… </p>
<p>③服务发现</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315162004885.png" alt="image-20240315162004885"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DiscoveryClient discoveryClient;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.根据服务名称，拉取服务的实例列表</span></span><br><span class="line">    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;item-service&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.负载均衡，挑选一个实例   </span></span><br><span class="line">    <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(RandomUtil.randomInt(instances.size())); </span><br><span class="line">    <span class="comment">//这个是随机负载均衡</span></span><br><span class="line">    <span class="comment">// 3.获取实例的IP和端口    </span></span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> instance.getUri();</span><br><span class="line">   <span class="comment">// ... 略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nacos为这些提供了API</p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315170136819.png" alt="image-20240315170136819"></p>
<h2 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h2><h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><p>OpenFeign是一个声明式的http客户端，是SpringCloud在Eureka公司开源的Feign基础上改造而来。官方地址：<a target="_blank" rel="noopener" href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a></p>
<p><strong>其作用就是基于SpringMVC的常见注解，帮我们优雅的实现http请求的发送。</strong></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240315171700078.png" alt="image-20240315171700078"></p>
<h4 id="①-引入依赖，包括OpenFeign和负载均衡组件SpringCloudLoadBalancer"><a href="#①-引入依赖，包括OpenFeign和负载均衡组件SpringCloudLoadBalancer" class="headerlink" title="① 引入依赖，包括OpenFeign和负载均衡组件SpringCloudLoadBalancer"></a>① 引入依赖，包括OpenFeign和负载均衡组件SpringCloudLoadBalancer</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--OpenFeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--负载均衡--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个依赖里面有各种负载均衡的一些，早期用ribbon，后期用这个loadbalancer--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="②通过-EnableFeignClients注解，启用OpenFeign功能"><a href="#②通过-EnableFeignClients注解，启用OpenFeign功能" class="headerlink" title="②通过@EnableFeignClients注解，启用OpenFeign功能"></a>②通过@EnableFeignClients注解，启用OpenFeign功能</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartApplication</span> &#123; <span class="comment">// ... 略 &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="③编写FeignClient"><a href="#③编写FeignClient" class="headerlink" title="③编写FeignClient"></a>③编写FeignClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;item-service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemClient</span> &#123;</span><br><span class="line">	<span class="meta">@GetMapping(&quot;/items&quot;)</span></span><br><span class="line">    List&lt;ItemDTO&gt; <span class="title function_">queryItemByIds</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> Collection&lt;Long&gt; ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="④使用FeignClient，实现远程调用"><a href="#④使用FeignClient，实现远程调用" class="headerlink" title="④使用FeignClient，实现远程调用"></a>④使用FeignClient，实现远程调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;ItemDTO&gt; items = itemClient.queryItemByIds(List.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>));</span><br></pre></td></tr></table></figure>



<h3 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h3><p>OpenFeign对Http请求做了优雅的伪装，不过其底层发起http请求，依赖于其它的框架。这些框架可以自己选择，包括以下三种：</p>
<ul>
<li>HttpURLConnection：默认实现，不支持连接池</li>
<li>Apache HttpClient ：支持连接池</li>
<li>OKHttp：支持连接池</li>
</ul>
<p>具体源码可以参考<strong>FeignBlockingLoadBalancerClient</strong>类中的<strong>delegate</strong>成员变量。</p>
<h4 id="OpenFeign整合OKHttp的步骤"><a href="#OpenFeign整合OKHttp的步骤" class="headerlink" title="OpenFeign整合OKHttp的步骤"></a>OpenFeign整合OKHttp的步骤</h4><h5 id="①引入依赖"><a href="#①引入依赖" class="headerlink" title="①引入依赖"></a>①引入依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ok-http--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="②开启连接池功能"><a href="#②开启连接池功能" class="headerlink" title="②开启连接池功能"></a>②开启连接池功能</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">feign:  </span><br><span class="line">	okhttp:</span><br><span class="line">		enabled: <span class="literal">true</span> # 开启OKHttp连接池支持</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240316093447481.png" alt="image-20240316093447481"></p>
<p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240316093502128.png" alt="image-20240316093502128"></p>
<p>当定义的FeignClient不在SpringBootApplication的扫描包范围时，这些FeignClient无法使用。有两种方式解决：</p>
<h4 id="方式一：指定FeignClient所在包"><a href="#方式一：指定FeignClient所在包" class="headerlink" title="方式一：指定FeignClient所在包"></a>方式一：指定FeignClient所在包</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240316094114690.png" alt="image-20240316094114690"></p>
<h4 id="方式二：指定FeignClient字节码"><a href="#方式二：指定FeignClient字节码" class="headerlink" title="方式二：指定FeignClient字节码"></a>方式二：指定FeignClient字节码</h4><p><img src="/../blog_images/Java%E5%BE%AE%E6%9C%8D%E5%8A%A1/image-20240316094121599.png" alt="image-20240316094121599"></p>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>OpenFeign只会在FeignClient所在包的日志级别为<strong>DEBUG</strong>时，才会输出日志。而且其日志级别有4级：</p>
<p><strong>NONE</strong>：不记录任何日志信息，这是默认值。</p>
<p><strong>BASIC</strong>：仅记录请求的方法，URL以及响应状态码和执行时间</p>
<p><strong>HEADERS</strong>：在BASIC的基础上，额外记录了请求和响应的头信息</p>
<p><strong>FULL</strong>：记录所有请求和响应的明细，包括头信息、请求体、元数据。</p>
<p>由于Feign默认的日志级别就是NONE，所以默认我们看不到请求日志。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><h4 id="如何利用OpenFeign实现远程调用？"><a href="#如何利用OpenFeign实现远程调用？" class="headerlink" title="如何利用OpenFeign实现远程调用？"></a>如何利用OpenFeign实现远程调用？</h4><p>•引入OpenFeign和SpringCloudLoadBalancer依赖</p>
<p>•利用@EnableFeignClients注解开启OpenFeign功能</p>
<p>•编写FeignClient</p>
<h4 id="如何配置OpenFeign的连接池？"><a href="#如何配置OpenFeign的连接池？" class="headerlink" title="如何配置OpenFeign的连接池？"></a>如何配置OpenFeign的连接池？</h4><p>•引入http客户端依赖，例如OKHttp、HttpClient</p>
<p>•配置yaml文件，打开OpenFeign连接池开关</p>
<h4 id="OpenFeign使用的最佳实践方式是什么？"><a href="#OpenFeign使用的最佳实践方式是什么？" class="headerlink" title="OpenFeign使用的最佳实践方式是什么？"></a>OpenFeign使用的最佳实践方式是什么？</h4><p>•由服务提供者编写独立module，将FeignClient及DTO抽取</p>
<h4 id="如何配置OpenFeign输出日志的级别？"><a href="#如何配置OpenFeign输出日志的级别？" class="headerlink" title="如何配置OpenFeign输出日志的级别？"></a>如何配置OpenFeign输出日志的级别？</h4><p>•声明类型为Logger.Level的Bean</p>
<p>•在@FeignClient或@EnableFeignClients注解上使用</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/14/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/14/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">Java多线程与并发编程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-14 20:10:45 / 修改时间：20:23:19" itemprop="dateCreated datePublished" datetime="2024-03-14T20:10:45+08:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">Java体系知识</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E4%BD%93%E7%B3%BB%E7%9F%A5%E8%AF%86/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">Java多线程和并发编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/11/JavaWeb-Maven/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lolo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Loloooo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Loloooo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/11/JavaWeb-Maven/" class="post-title-link" itemprop="url">JavaWeb-Maven</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-03-11 16:50:10 / 修改时间：20:15:01" itemprop="dateCreated datePublished" datetime="2024-03-11T16:50:10+08:00">2024-03-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaWeb/Maven%E9%AB%98%E7%BA%A7/" itemprop="url" rel="index"><span itemprop="name">Maven高级</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="分模块设计与开发"><a href="#分模块设计与开发" class="headerlink" title="分模块设计与开发"></a>分模块设计与开发</h1><p>如果都是一个整体，不便维护，难以复用</p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311165526006.png" alt="image-20240311165526006"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311170348905.png" alt="image-20240311170348905"></p>
<h2 id="分模块设计"><a href="#分模块设计" class="headerlink" title="分模块设计"></a>分模块设计</h2><p><img src="/../blog_images/JavaWeb-Maven/image-20240311171016127.png" alt="image-20240311171016127"></p>
<p>直接在tlias-web-management里引入tlias-pojo和tlias-utils的依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建maven模块 tlias-pojo，存放实体类。</span><br><span class="line"></span><br><span class="line">创建maven模块 tlias-utils，存放相关工具类。</span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/JavaWeb-Maven/image-20240311171024408.png" alt="image-20240311171024408"></p>
<h3 id="step1：创建maven模块tlias-pojo，存放实体类"><a href="#step1：创建maven模块tlias-pojo，存放实体类" class="headerlink" title="step1：创建maven模块tlias-pojo，存放实体类"></a>step1：创建maven模块tlias-pojo，存放实体类</h3><img src="../blog_images/JavaWeb-Maven/image-20240311171425231.png" alt="image-20240311171425231" style="zoom:50%;" />

<img src="../blog_images/JavaWeb-Maven/image-20240311171559834.png" alt="image-20240311171559834" style="zoom:50%;" />

<img src="../blog_images/JavaWeb-Maven/image-20240311171641900.png" alt="image-20240311171641900" style="zoom:33%;" />

<h3 id="step2：在主程序中引用模块"><a href="#step2：在主程序中引用模块" class="headerlink" title="step2：在主程序中引用模块"></a>step2：在主程序中引用模块</h3><p><img src="/../blog_images/JavaWeb-Maven/image-20240311172832257.png" alt="image-20240311172832257"></p>
<h1 id="继承与聚合"><a href="#继承与聚合" class="headerlink" title="继承与聚合"></a>继承与聚合</h1><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p><strong>概念：</strong>继承描述的是两个工程之间的关系，和java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承。</p>
<p><strong>作用：</strong>简化依赖配置，统一管理依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实现：&lt;parent&gt;...&lt;/parent&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/JavaWeb-Maven/image-20240311191546007.png" alt="image-20240311191546007"></p>
<h3 id="继承关系实现"><a href="#继承关系实现" class="headerlink" title="继承关系实现"></a>继承关系实现</h3><p>① 创建maven模块 tlias-parent ，该工程为父工程，设置打包方式pom(默认jar)。</p>
<blockquote>
<p>打包方式：</p>
<p>jar：普通模块打包，springboot项目基本都是jar包（内嵌tomcat运行）</p>
<p>war：普通web程序打包，需要部署在外部的tomcat服务器中运行</p>
<p>pom：父工程或聚合工程，该模块不写代码，仅进行依赖管理</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.7</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt;</span><br><span class="line"> &lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;groupId&gt;com.itheima&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;tlias-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>② 在子工程的pom.xml文件中，配置继承关系</p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311194125306.png" alt="image-20240311194125306"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在子工程中，配置了继承关系之后，坐标中的groupId是可以省略的，因为会自动继承父工程的 。</span><br><span class="line"></span><br><span class="line">relativePath指定父工程的pom文件的相对位置（如果不指定，将从本地仓库/远程仓库查找该工程）。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/JavaWeb-Maven/image-20240311192123449.png" alt="image-20240311192123449"></p>
<p>③ 在父工程中配置各个工程共有的依赖（子工程会自动继承父工程的依赖）。</p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311192033341.png" alt="image-20240311192033341"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ps:若父子工程都配置了同一个依赖的不同版本，以子工程的为准。</p>
</blockquote>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311194512198.png" alt="image-20240311194512198"></p>
<h3 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在maven中，可以在父工程的pom文件中通过 &lt;dependencyManagement&gt; 来统一管理依赖版本</span><br></pre></td></tr></table></figure>

<p><img src="/../blog_images/JavaWeb-Maven/image-20240311195137523.png" alt="image-20240311195137523"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311195305186.png" alt="image-20240311195305186"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311195401893.png" alt="image-20240311195401893"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311200349898.png" alt="image-20240311200349898"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt; 与 &lt;dependencies&gt;的区别是什么?</span><br><span class="line">&lt;dependencies&gt; 是直接依赖,在父工程配置了依赖,子工程会直接继承下来。 </span><br><span class="line">&lt;dependencyManagement&gt; 是统一管理依赖版本,不会直接依赖，还需要在子工程中引入所需依赖(无需指定版本)</span><br></pre></td></tr></table></figure>



<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><p><img src="/../blog_images/JavaWeb-Maven/image-20240311200842420.png" alt="image-20240311200842420"></p>
<p>要把几个模块全部安装到本地之后才能打包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">聚合</span><br><span class="line">      将多个模块组织成一个整体，同时进行项目的构建。</span><br><span class="line">聚合工程</span><br><span class="line">      一个不具有业务功能的“空”工程（有且仅有一个pom文件）</span><br><span class="line">作用</span><br><span class="line">      快速构建项目（无需根据依赖关系手动构建，直接在聚合工程上构建即可）</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maven中可以通过 &lt;modules&gt; 设置当前聚合工程所包含的子模块名称</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--聚合--&gt;</span>父工程（聚合工程）</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>../tlias-pojo<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>../tlias-utils<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>../tlias-web-management<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>l聚合工程中所包含的模块，在构建时，会自动根据模块间的依赖关系设置构建顺序，与聚合工程中模块的配置书写位置无关。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><ul>
<li>聚合用于快速构建项目</li>
<li>继承用于简化依赖配置、统一管理依赖</li>
</ul>
<h3 id="相同点："><a href="#相同点：" class="headerlink" title="相同点："></a>相同点：</h3><ul>
<li>聚合与继承的pom.xml文件打包方式均为pom，可以将两种关系制作到同一个pom文件中</li>
<li>聚合与继承均属于设计型模块，并无实际的模块内容</li>
</ul>
<h3 id="不同点："><a href="#不同点：" class="headerlink" title="不同点："></a>不同点：</h3><ul>
<li>聚合是在聚合工程中配置关系，聚合可以感知到参与聚合的模块有哪些</li>
<li>继承是在子模块中配置关系，父模块无法感知哪些子模块继承了自己</li>
</ul>
<h1 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h1><p>私服是一种特殊的远程仓库，它是架设在局域网内的仓库服务，用来代理位于外部的中央仓库，用于解决团队内部的资源共享与资源同步问题。</p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311201437607.png" alt="image-20240311201437607"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311201447693.png" alt="image-20240311201447693"></p>
<p><img src="/../blog_images/JavaWeb-Maven/image-20240311201500467.png" alt="image-20240311201500467"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">lolo</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
